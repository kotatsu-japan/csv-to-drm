<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>CSV to DRM ConverterğŸ¥</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f7f9fc;
      color: #333;
      margin: 0;
      padding: 2em;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    h2 {
      border-bottom: 2px solid #ddd;
    }
    h1, h2 {
      color: #333;
      padding-bottom: 0.3em;
      margin-bottom: 1em;
    }
    code, pre { background: #f9f9f9; padding: 0.2em 0.4em; border-radius: 4px; }
    li { margin-bottom: 0.5em; }
    .section {
      margin-bottom: 2em;
      text-align: center;
    }
    .button-primary {
      display: inline-block;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease, transform 0.2s ease;
      margin: 0.5em;
    }
    .button-primary:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }
    input[type="file"] {
      display: none;
    }
    #fileName {
      margin-top: 0.5em;
      font-size: 14px;
      color: #444;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <h1>CSV to DRM ConverterğŸ¥</h1>
  <h2>ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</h2>
  <p>BFDã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Cubaseã§ä½¿ãˆã‚‹ãƒ‰ãƒ©ãƒ ãƒãƒƒãƒ—ï¼ˆ.drmãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã«å¤‰æ›ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚½ãƒ•ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã ã‘ã§å®Œçµã—ã¾ã™ã€‚</p>
  <h2>å¯¾å¿œCSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼</h2>
  <p>CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®åˆ—ãŒå¿…è¦ã§ã™ï¼š</p>
  <ul>
    <li><code>slotID</code></li>
    <li><code>slotName</code></li>
    <li><code>articID</code></li>
    <li><code>articName</code></li>
    <li><code>note</code>ï¼ˆMIDIãƒãƒ¼ãƒˆç•ªå·ï¼‰</li>
    <li><code>noteName</code>ï¼ˆä¾‹: C0, D#2 ãªã©ï¼‰</li>
  </ul>
  <h2>ä½¿ã„æ–¹</h2>
  <ol>
    <li>ãƒ„ãƒ¼ãƒ«ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™</li>
    <li>ã€ŒCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
    <li>BFDã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</li>
    <li>ã€Œå¤‰æ›ã—ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
    <li>.drm ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆã‚’é¸æŠã—ã¾ã™ã€‚</li>
  </ol>
  <h2>å‡ºåŠ›ã•ã‚Œã‚‹ .drm ãƒ•ã‚¡ã‚¤ãƒ«ã®ä»•æ§˜</h2>
  <ul>
    <li>MIDIãƒãƒ¼ãƒˆç•ªå·ï¼ˆ0ã€œ127ï¼‰ã™ã¹ã¦ã«å¯¾å¿œã™ã‚‹128å€‹ã®ãƒãƒ¼ãƒ‰ã‚’å«ã¿ã¾ã™</li>
    <li>CSVã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒˆç•ªå·ã¯ã€è¡¨ç¤ºåã¨ã—ã¦ <code>slotName - articName</code> ãŒä½¿ã‚ã‚Œã¾ã™</li>
    <li>å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒˆç•ªå·ã¯ç©ºã®ãƒãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™</li>
    <li>Cubaseã§èª­ã¿è¾¼ã‚ã‚‹XMLå½¢å¼ï¼ˆãƒ‰ãƒ©ãƒ ãƒãƒƒãƒ—ï¼‰ã§å‡ºåŠ›ã•ã‚Œã¾ã™</li>
  </ul>
  <h2>ã”æ³¨æ„</h2>
  <ul>
    <li>CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒç•°ãªã‚‹å ´åˆã¯æ­£ã—ãå‹•ä½œã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™</li>
    <li>ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€å®‰å…¨ã§ã™</li>
  </ul>

  <div class="section">
    <div class="button-group">
      <label class="button-primary">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
        <input type="file" id="csvFile" accept=".csv" onchange="updateFileName()" />
      </label>
      <button
        onclick="convertToDrm()" 
        class="button-primary"
      >
        å¤‰æ›ã—ã¦ä¿å­˜
      </button>
    </div>
    <div id="fileName">é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼šæœªé¸æŠ</div>
  </div>

  <script>
    function convertToDrm() {
      const fileInput = document.getElementById('csvFile');
      if (!fileInput.files.length) {
        alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        const csv = e.target.result;
        const lines = csv.trim().split("\n");
        const headers = lines[0].split(",").map(h => h.trim());

        const getIndex = name => headers.indexOf(name);
        const slotNameIdx = getIndex("slotName");
        const articNameIdx = getIndex("articName");
        const noteIdx = getIndex("note");

        if (slotNameIdx === -1 || articNameIdx === -1 || noteIdx === -1) {
          alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªåˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
          return;
        }

        const csvItems = lines.slice(1).map(line => {
          const cols = line.split(",").map(c => c.trim());
          return {
            note: cols[noteIdx],
            displayName: cols[slotNameIdx] ? `${cols[slotNameIdx]} - ${cols[articNameIdx]}` : cols[articNameIdx]
          };
        });

        csvItems.sort((a, b) => Number(a.note) - Number(b.note));

        const xmlParts = [];
        xmlParts.push('<?xml version="1.0" encoding="utf-8"?>');
        xmlParts.push('<DrumMap>');
        xmlParts.push(`  <string name="Name" value="${file.name.replace(/\.csv$/i, "")}" wide="true" />`);
        xmlParts.push('  <list name="Quantize" type="list">');
        xmlParts.push('    <item>');
        xmlParts.push('      <int name="Grid" value="4" />');
        xmlParts.push('      <int name="Type" value="0" />');
        xmlParts.push('      <float name="Swing" value="0" />');
        xmlParts.push('      <int name="Legato" value="50" />');
        xmlParts.push('    </item>');
        xmlParts.push('  </list>');
        xmlParts.push('  <list name="Map" type="list">');

        for (let i = 0; i < 128; i++) {
          xmlParts.push('    <item>');
          xmlParts.push(`      <int name="INote" value="${i}" />`);
          xmlParts.push(`      <int name="ONote" value="${i}" />`);
          xmlParts.push('      <int name="Channel" value="9" />');
          xmlParts.push('      <float name="Length" value="200" />');
          xmlParts.push('      <int name="Mute" value="0" />');
          xmlParts.push(`      <int name="DisplayNote" value="${i}" />`);
          xmlParts.push('      <int name="HeadSymbol" value="0" />');
          xmlParts.push('      <int name="Voice" value="0" />');
          xmlParts.push('      <int name="PortIndex" value="0" />');
          const csvItem = csvItems.find(csvItem => parseInt(csvItem.note) === i);
          if (csvItem) {
            xmlParts.push(`      <string name="Name" value="${csvItem.displayName}" wide="true" />`);
          } else {
            xmlParts.push(`      <string name="Name" value="" wide="true" />`);
          }
          xmlParts.push('      <int name="QuantizeIndex" value="0" />');
          xmlParts.push('    </item>');
        };
        xmlParts.push('  </list>');

        xmlParts.push('  <list name="Order" type="int">');
        for (let i = 0; i < 128; i++) {
          xmlParts.push(`    <item value="${i}" />`);
        };
        xmlParts.push('  </list>');

        xmlParts.push('  <list name="OutputDevices" type="list">');
        xmlParts.push('    <item>');
        xmlParts.push('      <string name="DeviceName" value="Default Device" />');
        xmlParts.push('      <string name="PortName" value="Default Port" />');
        xmlParts.push('    </item>');
        xmlParts.push('  </list>');
        xmlParts.push('  <int name="Flags" value="0" />');
        xmlParts.push('</DrumMap>');

        const xmlContent = xmlParts.join("\n");
        const blob = new Blob([xmlContent], { type: "application/xml" });

        const defaultName = file.name.replace(/\.csv$/i, ".drm");
        const url = URL.createObjectURL(blob);

        // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åæŒ‡å®šï¼‰
        const a = document.createElement("a");
        a.href = url;
        a.download = defaultName;
        a.click();

        URL.revokeObjectURL(url);
      };

      reader.readAsText(file, 'utf-8');
    }

    function updateFileName() {
      const fileInput = document.getElementById('csvFile');
      const fileNameSpan = document.getElementById('fileName');
      if (fileInput.files.length > 0) {
          fileNameSpan.textContent = 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼š ' + fileInput.files[0].name;
      } else {
          fileNameSpan.textContent = 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼šæœªé¸æŠ';
      }
    }
  </script>
  
  <footer style="margin-top: 3em; padding: 1em; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ccc;">
    <p>Â© 2025 N'jamena Company</p>
  </footer>
</body>
</html>
